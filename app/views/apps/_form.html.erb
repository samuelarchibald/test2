
<%= form_for @app, html: { multipart: true } do |f| %>
  <!-- stripe javascript tag -->
  
  <% if @app.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@app.errors.count, "error") %> prohibited this app from being saved:</h2>
      <ul>
      <% @app.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
  
  <div class="title">
    <h3>App Info</h3>
  </div>

  <div class="new-app-info">
    <div class="form-group">
      <%= f.text_field :name, class: "form-control", id: 'nameField', placeholder: 'App Name' %>
    </div>
    <div class="form-group">
      <%= f.text_field :store, class: "form-control", id: 'storeField', placeholder: 'Store (ex. iTunes, Google Play, Windows)' %>
    </div>
    <div class="form-group">
      <%= text_field_tag :app_price, '', class: "form-control app-price", id: 'storeField', placeholder: 'App Price' %>
    </div>
    <div class="form-group">
      <%= f.text_field :url, class: "form-control", id: 'urlField', placeholder: 'App URL (ex. http://itunes.com/us/app/app-name)' %>
    </div>
    <div class="form-group">
      <%= f.label :image %><br>
      <%= f.file_field :image, class: "form-control form-image-control" %>
    </div>
    <div class="form-group">
      <%= f.text_field :description, class: "form-control", id: 'descriptionField', placeholder: 'Description' %>
    </div>

    <div class="new-app-button">
      Next Step
    </div>
  </div>
  <!-- STRIPE AND NOMINATIONS RECIPT PROCESSING -->

  <%= hidden_field_tag 'stripeToken' %>
  <%= hidden_field_tag 'stripeEmail' %>
  <%= hidden_field_tag 'amount', 499 %>
  <%= hidden_field_tag 'appName' %>
  <%= hidden_field_tag 'appStore' %>
  <%= hidden_field_tag 'appUrl' %>
  <%= hidden_field_tag 'appDescription' %>

  <% if @app.id == nil && 2 == 4 %>
  <div class="stripe-button">
    <button id="thisbutton" type="button" class="btn btn-default">Pay With Card!</button>
  </div>
    <%= f.submit %>
  <% end %>

  <!-- STRIPE JAVASCRIPT -->
  <script>
    var handler = StripeCheckout.configure({
      key: '<%= Rails.configuration.stripe[:publishable_key] %>',
      token: function(token, arg) {
        document.getElementById("stripeToken").value = token.id;
        document.getElementById("stripeEmail").value = token.email;
        document.getElementById("new_app").submit();
      }
    });

    document.getElementById('thisbutton').addEventListener('click', function(e) {

      // inputting the forms to nomination
      document.getElementById("appName").value = document.getElementById("nameField").value
      document.getElementById("appStore").value = document.getElementById("storeField").value
      document.getElementById("appUrl").value = document.getElementById("urlField").value
      document.getElementById("appDescription").value = document.getElementById("descriptionField").value

      handler.open({
        name: 'Silicon Beach App Awards',
        description: 'One App Nomination ($149.99)',
        amount: document.getElementById("amount").value
      });
      e.preventDefault();
    })
  </script>



<% end %>